<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê²°ê³¼ ë¦¬í¬íŠ¸ â€” ì••ë°•ë©´ì ‘ ì‹œë®¬ë ˆì´í„°</title>
<link rel="stylesheet" href="css/style.css">
<style>
  .report-header {
    text-align:center; padding:28px 0 20px;
  }
  .report-header h1 { font-size:22px; font-weight:900; }
  .report-header .meta { font-size:12px; color:var(--text-sub); margin-top:6px; }

  /* ì ìˆ˜ ë ˆì´ë” ëŒ€ì²´ - ê·¸ë¦¬ë“œ í˜• ì ìˆ˜ì¹´ë“œ */
  .score-section { display:grid; grid-template-columns:repeat(auto-fit,minmax(130px,1fr)); gap:10px; }
  .score-card {
    background:var(--bg-card2); border:1px solid var(--border);
    border-radius:10px; padding:14px 12px; text-align:center;
  }
  .score-card .s-label { font-size:10px; color:var(--text-sub); margin-bottom:6px; }
  .score-card .s-value { font-size:28px; font-weight:900; }
  .score-card .s-bar { height:4px; background:var(--border); border-radius:2px; margin-top:8px; }
  .score-card .s-fill { height:100%; border-radius:2px; }

  /* ê°•ì /ê°œì„ ì  */
  .feedback-cols { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media(max-width:580px){ .feedback-cols { grid-template-columns:1fr; } }

  .feedback-list { list-style:none; display:flex; flex-direction:column; gap:6px; }
  .feedback-list li {
    padding:8px 12px; border-radius:8px;
    font-size:12px; line-height:1.5;
    display:flex; align-items:flex-start; gap:8px;
  }
  .feedback-list.strength li { background:rgba(67,201,123,.1); border:1px solid rgba(67,201,123,.2); }
  .feedback-list.improve  li { background:rgba(224,154,58,.1);  border:1px solid rgba(224,154,58,.2); }

  /* ë‹µë³€ ìƒì„¸ */
  .answer-item {
    background:var(--bg-card2); border:1px solid var(--border);
    border-radius:10px; padding:14px 16px; margin-bottom:10px;
  }
  .answer-item .a-q { font-size:12px; font-weight:700; color:var(--accent); margin-bottom:6px; }
  .answer-item .a-text { font-size:13px; line-height:1.6; color:var(--text-main); }
  .answer-item .a-meta {
    margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;
    font-size:10px; color:var(--text-sub);
  }
  .a-meta span { padding:2px 8px; background:var(--bg-dark); border-radius:10px; }
  .a-meta span.ok   { color:var(--success); }
  .a-meta span.warn { color:var(--warn); }

  /* ì¢…í•© í”¼ë“œë°± */
  .overall-box {
    background:rgba(79,142,247,.08); border:1px solid rgba(79,142,247,.2);
    border-radius:12px; padding:18px 20px;
    font-size:14px; line-height:1.8; color:var(--text-main);
  }

  /* ë©´ì±… */
  .disclaimer {
    background:rgba(255,255,255,.03); border:1px solid var(--border);
    border-radius:8px; padding:12px 14px;
    font-size:11px; color:var(--text-dim); line-height:1.6;
  }

  /* ë‚´ë³´ë‚´ê¸° */
  .export-row { display:flex; gap:10px; flex-wrap:wrap; }

  /* í†µê³„ ì¹© */
  .stat-chips { display:flex; gap:8px; flex-wrap:wrap; }
  .stat-chip {
    padding:6px 14px; background:var(--bg-card2);
    border:1px solid var(--border); border-radius:20px;
    font-size:12px; color:var(--text-sub);
  }
  .stat-chip strong { color:var(--text-main); }
</style>
</head>
<body>

<header class="page-header">
  <span class="logo-text">ë©´ì ‘ ê²°ê³¼ <span>ë¦¬í¬íŠ¸</span></span>
</header>

<div class="container">

  <div class="report-header">
    <h1 id="report-title">ë©´ì ‘ ì™„ë£Œ!</h1>
    <div class="meta" id="report-meta"></div>
    <div style="margin-top:10px" id="report-badges"></div>
  </div>

  <!-- í•µì‹¬ í†µê³„ -->
  <div class="card" style="margin-bottom:16px">
    <div class="section-title" style="margin-bottom:12px">ğŸ“Š í•µì‹¬ ì§€í‘œ</div>
    <div class="stat-chips" id="stat-chips"></div>
  </div>

  <!-- ì ìˆ˜ ì¹´ë“œ -->
  <div class="card" style="margin-bottom:16px">
    <div class="section-title" style="margin-bottom:12px">ğŸ¯ í‰ê°€ ì ìˆ˜</div>
    <div class="score-section" id="score-section"></div>
  </div>

  <!-- ì¢…í•© í”¼ë“œë°± -->
  <div class="card" style="margin-bottom:16px">
    <div class="section-title" style="margin-bottom:12px">ğŸ’¬ ì¢…í•© í”¼ë“œë°±</div>
    <div class="overall-box" id="overall-feedback">
      í”¼ë“œë°±ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>
  </div>

  <!-- ê°•ì  / ê°œì„ ì  -->
  <div class="card" style="margin-bottom:16px">
    <div class="feedback-cols">
      <div>
        <div class="section-title" style="margin-bottom:10px;color:var(--success)">âœ… ê°•ì </div>
        <ul class="feedback-list strength" id="strengths-list"></ul>
      </div>
      <div>
        <div class="section-title" style="margin-bottom:10px;color:var(--warn)">ğŸ”§ ê°œì„ ì </div>
        <ul class="feedback-list improve" id="improvements-list"></ul>
      </div>
    </div>
  </div>

  <!-- ë‹µë³€ ìƒì„¸ -->
  <div class="card" style="margin-bottom:16px">
    <div class="section-title" style="margin-bottom:12px">ğŸ“ ë‹µë³€ë³„ ìƒì„¸</div>
    <div id="answers-detail"></div>
  </div>

  <!-- ë©´ì±… -->
  <div class="disclaimer" style="margin-bottom:16px">
    â€» ì´ ë¦¬í¬íŠ¸ëŠ” AI ìë™ ë¶„ì„ ê²°ê³¼ì´ë©°, ì‹¤ì œ ë©´ì ‘ í•©ê²©Â·ë¶ˆí•©ê²© ì—¬ë¶€ì™€ ë¬´ê´€í•©ë‹ˆë‹¤.<br>
    ìŒì„±Â·í‘œì • ë¶„ì„ ì •í™•ë„ëŠ” ì¡°ëª…, í™˜ê²½, ê¸°ê¸° ì„±ëŠ¥ì— ë”°ë¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>

  <!-- ë‚´ë³´ë‚´ê¸° -->
  <div class="card" style="margin-bottom:16px">
    <div class="section-title" style="margin-bottom:12px">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</div>
    <div class="export-row">
      <button class="btn btn-ghost" onclick="exportText()">ğŸ“„ í…ìŠ¤íŠ¸ ì €ì¥</button>
      <button class="btn btn-ghost" onclick="exportJSON()">ğŸ—‚ï¸ JSON ì €ì¥</button>
      <button class="btn btn-ghost" onclick="copyToClipboard(buildTextReport())">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
    </div>
    <div id="export-status" style="font-size:11px;color:var(--text-sub);margin-top:6px"></div>
  </div>

  <!-- í•˜ë‹¨ ë²„íŠ¼ -->
  <div style="display:flex;gap:12px;justify-content:center;padding-bottom:32px">
    <button class="btn btn-ghost" onclick="goTo('device-check.html')">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
    <button class="btn btn-primary" onclick="goTo('index.html')">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
  </div>

</div>

<div id="toast-container"></div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script>
  window.onload = () => {
    const report = APP.getSessionReport();
    if (!report) {
      document.getElementById('report-title').textContent = 'ë¦¬í¬íŠ¸ ì—†ìŒ';
      document.getElementById('overall-feedback').textContent = 'ì„¸ì…˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      return;
    }
    renderReport(report);
  };

  function renderReport(r) {
    // í—¤ë”
    const diffLabel = { easy:'í•˜(ì‰¬ì›€)', medium:'ì¤‘(ë³´í†µ)', hard:'ìƒ(ì–´ë ¤ì›€)' }[r.difficulty] || 'ì¤‘';
    const modeLabel = { public_servant:'ê³µë¬´ì›', public_corp:'ê³µê¸°ì—…', mixed:'í˜¼í•©' }[r.mode] || 'í˜¼í•©';
    const startDate = new Date(r.startTime);
    document.getElementById('report-meta').textContent =
      `${startDate.toLocaleDateString('ko-KR')} ${startDate.toLocaleTimeString('ko-KR', {hour:'2-digit',minute:'2-digit'})} | ì†Œìš”ì‹œê°„ ${formatTime(r.duration || 0)}`;

    document.getElementById('report-badges').innerHTML = `
      <span class="badge badge-${r.difficulty}">${diffLabel}</span>
      <span class="badge" style="margin-left:6px;background:rgba(79,142,247,.15);color:var(--accent)">${modeLabel}</span>
    `;

    // í•µì‹¬ í†µê³„
    document.getElementById('stat-chips').innerHTML = [
      `<div class="stat-chip">ì´ ì§ˆë¬¸ <strong>${(r.answers || []).length}ê°œ</strong></div>`,
      `<div class="stat-chip">ë°˜ë³µì–´ <strong>${((r.fillerWordRate||0)).toFixed(1)}íšŒ/ì§ˆë¬¸</strong></div>`,
      `<div class="stat-chip">í‰ê·  ì‘ë‹µ <strong>${((r.avgResponseTime||0)).toFixed(1)}ì´ˆ</strong></div>`,
      `<div class="stat-chip">ì‹œì„  ìœ ì§€ <strong>${((r.gazeScore||0)*100).toFixed(0)}%</strong></div>`,
    ].join('');

    // ì ìˆ˜ ì¹´ë“œ
    const scores = [
      { label:'ë‹µë³€ ë‚´ìš©', value: r.contentScore||0,  color:'var(--accent)' },
      { label:'ë…¼ë¦¬ êµ¬ì¡°', value: r.logicScore||0,    color:'var(--accent)' },
      { label:'ë§ ëª…ë£Œë„', value: r.clarityScore||0,  color:'var(--success)' },
      { label:'ì••ë°• ëŒ€ì‘', value: r.pressureScore||0, color:'var(--warn)' },
      { label:'ì‹œì„  ìœ ì§€', value: r.gazeScore||0,     color:'var(--success)' },
    ];
    document.getElementById('score-section').innerHTML = scores.map(s => {
      const pct = Math.round((s.value || 0) * 100);
      return `<div class="score-card">
        <div class="s-label">${s.label}</div>
        <div class="s-value" style="color:${s.color}">${pct}</div>
        <div style="font-size:9px;color:var(--text-dim)">/ 100ì </div>
        <div class="s-bar"><div class="s-fill" style="width:${pct}%;background:${s.color}"></div></div>
      </div>`;
    }).join('');

    // ì¢…í•© í”¼ë“œë°±
    document.getElementById('overall-feedback').textContent =
      r.overallFeedback || 'í”¼ë“œë°±ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';

    // ê°•ì 
    const strengthsEl = document.getElementById('strengths-list');
    (r.strengths || []).forEach(s => {
      const li = document.createElement('li');
      li.innerHTML = `<span style="color:var(--success);flex-shrink:0">âœ“</span> ${s}`;
      strengthsEl.appendChild(li);
    });
    if (!(r.strengths?.length)) {
      strengthsEl.innerHTML = '<li style="color:var(--text-dim)">ë°ì´í„° ì—†ìŒ</li>';
    }

    // ê°œì„ ì 
    const improvEl = document.getElementById('improvements-list');
    (r.improvements || []).forEach(s => {
      const li = document.createElement('li');
      li.innerHTML = `<span style="color:var(--warn);flex-shrink:0">â†’</span> ${s}`;
      improvEl.appendChild(li);
    });
    if (!(r.improvements?.length)) {
      improvEl.innerHTML = '<li style="color:var(--text-dim)">ë°ì´í„° ì—†ìŒ</li>';
    }

    // ë‹µë³€ ìƒì„¸
    const detailEl = document.getElementById('answers-detail');
    (r.answers || []).forEach((a, i) => {
      const hasText = a.answerText && a.answerText.trim();
      detailEl.innerHTML += `
        <div class="answer-item">
          <div class="a-q">Q${i+1}. ${a.questionText}</div>
          <div class="a-text">${hasText ? a.answerText : '<span style="color:var(--text-dim)">(ë‹µë³€ ì—†ìŒ)</span>'}</div>
          <div class="a-meta">
            <span>â± ${(a.duration||0).toFixed(1)}ì´ˆ</span>
            <span class="${(a.fillerCount||0) > 3 ? 'warn' : 'ok'}">ë°˜ë³µì–´ ${a.fillerCount||0}íšŒ</span>
            <span class="${a.hasConclusion ? 'ok':'warn'}">ë‘ê´„ì‹ ${a.hasConclusion?'âœ“':'âœ—'}</span>
            <span class="${a.hasEvidence ? 'ok':'warn'}">ê·¼ê±° ${a.hasEvidence?'âœ“':'âœ—'}</span>
            <span class="${a.hasExample ? 'ok':'warn'}">ì˜ˆì‹œ ${a.hasExample?'âœ“':'âœ—'}</span>
            <span>ì‹œì„  ${((a.gazeRatio||0)*100).toFixed(0)}%</span>
          </div>
        </div>`;
    });
  }

  // â”€â”€ ë‚´ë³´ë‚´ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildTextReport() {
    const r = APP.getSessionReport();
    if (!r) return 'ë°ì´í„° ì—†ìŒ';
    const diffLabel = { easy:'í•˜(ì‰¬ì›€)', medium:'ì¤‘(ë³´í†µ)', hard:'ìƒ(ì–´ë ¤ì›€)' }[r.difficulty] || 'ì¤‘';
    const lines = [
      '=== ì••ë°•ë©´ì ‘ ì‹œë®¬ë ˆì´í„° ê²°ê³¼ ë¦¬í¬íŠ¸ ===',
      `ë‚ ì§œ: ${new Date(r.startTime).toLocaleString('ko-KR')}`,
      `ë‚œì´ë„: ${diffLabel} | ì†Œìš”ì‹œê°„: ${formatTime(r.duration||0)}`,
      '',
      '[í‰ê°€ ì ìˆ˜]',
      `  ë‹µë³€ ë‚´ìš©: ${Math.round((r.contentScore||0)*100)}ì `,
      `  ë…¼ë¦¬ êµ¬ì¡°: ${Math.round((r.logicScore||0)*100)}ì `,
      `  ë§ ëª…ë£Œë„: ${Math.round((r.clarityScore||0)*100)}ì `,
      `  ì••ë°• ëŒ€ì‘: ${Math.round((r.pressureScore||0)*100)}ì `,
      `  ì‹œì„  ìœ ì§€: ${Math.round((r.gazeScore||0)*100)}ì `,
      `  ë°˜ë³µì–´:    ${(r.fillerWordRate||0).toFixed(1)}íšŒ/ì§ˆë¬¸`,
      `  í‰ê·  ì‘ë‹µ: ${(r.avgResponseTime||0).toFixed(1)}ì´ˆ`,
      '',
      '[ì¢…í•© í”¼ë“œë°±]',
      r.overallFeedback || 'ì—†ìŒ',
      '',
      '[ê°•ì ]',
      ...(r.strengths||[]).map(s => `  - ${s}`),
      '',
      '[ê°œì„ ì ]',
      ...(r.improvements||[]).map(s => `  - ${s}`),
      '',
      '[ë‹µë³€ ìƒì„¸]',
      ...(r.answers||[]).flatMap((a, i) => [
        `Q${i+1}. ${a.questionText}`,
        `  A: ${a.answerText || '(ì—†ìŒ)'}`,
        `  (${(a.duration||0).toFixed(1)}ì´ˆ, ë°˜ë³µì–´ ${a.fillerCount||0}íšŒ)`,
        '',
      ]),
      'â€» ì´ ë¦¬í¬íŠ¸ëŠ” AI ìë™ ë¶„ì„ ê²°ê³¼ì´ë©° ì‹¤ì œ í•©ë¶ˆê³¼ ë¬´ê´€í•©ë‹ˆë‹¤.',
    ];
    return lines.join('\n');
  }

  function exportText() {
    const text = buildTextReport();
    const now = new Date();
    const fname = `interview_report_${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}.txt`;
    downloadFile(fname, text, 'text/plain;charset=utf-8');
    document.getElementById('export-status').textContent = `ì €ì¥ë¨: ${fname}`;
  }

  function exportJSON() {
    const r = APP.getSessionReport();
    const now = new Date();
    const fname = `interview_report_${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}.json`;
    downloadFile(fname, JSON.stringify(r, null, 2), 'application/json;charset=utf-8');
    document.getElementById('export-status').textContent = `ì €ì¥ë¨: ${fname}`;
  }
</script>
</body>
</html>
