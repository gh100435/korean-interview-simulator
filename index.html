<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì••ë°•ë©´ì ‘ ì‹œë®¬ë ˆì´í„°</title>
<link rel="stylesheet" href="css/style.css">
<style>
  .hero { text-align: center; padding: 40px 0 28px; }
  .hero h1 { font-size: 28px; font-weight: 900; letter-spacing: -.02em; }
  .hero h1 span { color: var(--accent); }
  .hero p  { color: var(--text-sub); margin-top: 8px; font-size: 14px; }

  .section-block { margin-bottom: 20px; }
  .section-block h2 { font-size: 13px; font-weight: 700; color: var(--text-dim);
                      text-transform: uppercase; letter-spacing: .08em; margin-bottom: 10px; }

  /* ë‚œì´ë„ ì¹´ë“œ */
  .diff-card { flex:1; min-width:100px; padding:16px 12px; background:var(--bg-card2);
               border:2px solid var(--border); border-radius:10px; cursor:pointer;
               transition:all .18s; text-align:center; }
  .diff-card:hover { border-color:var(--accent); }
  .diff-card.active { border-color:var(--accent); background:rgba(79,142,247,.12); }
  .diff-card .diff-icon { font-size:28px; margin-bottom:8px; }
  .diff-card .diff-name { font-weight:700; font-size:14px; }
  .diff-card .diff-desc { font-size:11px; color:var(--text-sub); margin-top:4px; line-height:1.4; }

  /* íŒ¨ë„ ë¯¸ë¦¬ë³´ê¸° */
  .panel-preview { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; min-height:36px; }
  .panel-chip { padding:4px 10px; background:var(--bg-card2); border:1px solid var(--border);
                border-radius:20px; font-size:11px; color:var(--text-sub); }

  /* Ollama ìƒíƒœ */
  .ollama-status-row { display:flex; align-items:center; gap:10px; }
  .ollama-dot { width:10px; height:10px; border-radius:50%; background:var(--text-dim); flex-shrink:0; }
  .ollama-dot.ok  { background:var(--success); box-shadow:0 0 6px rgba(67,201,123,.6); }
  .ollama-dot.err { background:var(--danger);  box-shadow:0 0 6px rgba(229,72,77,.6); }
  #ollama-status-text { font-size:13px; }
  #ollama-detail { font-size:11px; color:var(--text-dim); margin-top:4px; }

  /* ì‹œì‘ ë²„íŠ¼ */
  .start-area { margin-top:28px; text-align:center; }
  #btn-start { padding:14px 48px; font-size:16px; border-radius:12px; }

  .tip { font-size:11px; color:var(--text-dim); margin-top:10px; }
</style>
</head>
<body>

<header class="page-header">
  <span class="logo-text">ì••ë°•ë©´ì ‘ <span>ì‹œë®¬ë ˆì´í„°</span></span>
  <span style="margin-left:auto;font-size:11px;color:var(--text-dim)">MVP v0.1</span>
</header>

<div class="container">

  <!-- HERO -->
  <div class="hero">
    <h1>ì‹¤ì „ì²˜ëŸ¼, ì§€ê¸ˆ ë°”ë¡œ<br><span>ì••ë°•ë©´ì ‘ í›ˆë ¨</span></h1>
    <p>ê³µë¬´ì›Â·ê³µê¸°ì—… ë©´ì ‘ ëŒ€ë¹„ | AI ë©´ì ‘ê´€ 10ì¢… | ì‹¤ì‹œê°„ í”¼ë“œë°±</p>
  </div>

  <!-- Ollama ì—°ê²° ìƒíƒœ -->
  <div class="card section-block">
    <h2>ğŸ¤– Ollama ë¡œì»¬ AI</h2>
    <div class="ollama-status-row">
      <div class="ollama-dot" id="ollama-dot"></div>
      <span id="ollama-status-text">ì—°ê²° í™•ì¸ ì¤‘...</span>
      <button class="btn btn-ghost" style="margin-left:auto;padding:4px 10px;font-size:11px"
        onclick="checkOllama()">ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div id="ollama-detail"></div>
  </div>

  <!-- ë‚œì´ë„ -->
  <div class="card section-block">
    <h2>ğŸ“Š ë‚œì´ë„ ì„ íƒ</h2>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <div class="diff-card" id="diff-easy" onclick="selectDiff('easy')">
        <div class="diff-icon">ğŸ˜Š</div>
        <div class="diff-name">í•˜ (ì‰¬ì›€)</div>
        <div class="diff-desc">ì¹œì ˆí•œ ì§ˆë¬¸ ì¤‘ì‹¬<br>ê¼¬ë¦¬ì§ˆë¬¸ ë‚®ìŒ<br>ì‹œê°„ ì—¬ìœ </div>
      </div>
      <div class="diff-card active" id="diff-medium" onclick="selectDiff('medium')">
        <div class="diff-icon">ğŸ˜</div>
        <div class="diff-name">ì¤‘ (ë³´í†µ)</div>
        <div class="diff-desc">ê²€ì¦ ì§ˆë¬¸ ì¦ê°€<br>ê¼¬ë¦¬ì§ˆë¬¸ ì¤‘ê°„<br>ì‹œê°„ ì œí•œ ë„ì…</div>
      </div>
      <div class="diff-card" id="diff-hard" onclick="selectDiff('hard')">
        <div class="diff-icon">ğŸ˜¤</div>
        <div class="diff-name">ìƒ (ì–´ë ¤ì›€)</div>
        <div class="diff-desc">ê³µê²©ì  ì••ë°•<br>ì¦ì€ ë¼ì–´ë“¤ê¸°<br>ì´˜ì´˜í•œ ì‹œê°„ ì œí•œ</div>
      </div>
    </div>
    <!-- íŒ¨ë„ ë¯¸ë¦¬ë³´ê¸° -->
    <div style="margin-top:14px">
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:6px">ì˜ˆìƒ ë©´ì ‘ê´€ íŒ¨ë„</div>
      <div class="panel-preview" id="panel-preview"></div>
    </div>
  </div>

  <!-- ëª¨ë“œ -->
  <div class="card section-block">
    <h2>ğŸ›ï¸ ë©´ì ‘ ìœ í˜•</h2>
    <div class="select-group">
      <div class="select-btn" id="mode-public" onclick="selectMode('public_servant')">ê³µë¬´ì›</div>
      <div class="select-btn" id="mode-corp"   onclick="selectMode('public_corp')">ê³µê¸°ì—…</div>
      <div class="select-btn active" id="mode-mixed"  onclick="selectMode('mixed')">í˜¼í•©</div>
    </div>
  </div>

  <!-- ì˜µì…˜ -->
  <div class="card section-block">
    <h2>âš™ï¸ ì˜µì…˜</h2>
    <div style="display:flex;flex-direction:column;gap:12px">
      <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
        <input type="checkbox" id="opt-timelimit" checked style="width:16px;height:16px;accent-color:var(--accent)">
        <span style="font-size:13px">ë‹µë³€ ì‹œê°„ ì œí•œ ì‚¬ìš©</span>
      </label>
      <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
        <input type="checkbox" id="opt-subtitle" style="width:16px;height:16px;accent-color:var(--accent)">
        <span style="font-size:13px">ìë§‰ ì „ìš© ëª¨ë“œ (TTS/STT ìŒì„± ì—†ì´)</span>
      </label>
      <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
        <input type="checkbox" id="opt-typing" style="width:16px;height:16px;accent-color:var(--accent)">
        <span style="font-size:13px">í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë‹µë³€ (ë§ˆì´í¬ ì—†ì´)</span>
      </label>
    </div>
  </div>

  <!-- ì‹œì‘ -->
  <div class="start-area">
    <button class="btn btn-primary" id="btn-start" onclick="startInterview()">
      ë©´ì ‘ START
    </button>
    <p class="tip">âš ï¸ Ollamaê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤. í„°ë¯¸ë„ì—ì„œ <code>ollama serve</code>ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.</p>
  </div>

</div>

<div id="toast-container"></div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script>
  let selectedDiff = 'medium';
  let selectedMode = 'mixed';
  let ollamaOk = false;

  // â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.onload = () => {
    updatePanelPreview();
    checkOllama();
  };

  // â”€â”€ Ollama ì—°ê²° í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function checkOllama() {
    const dot  = document.getElementById('ollama-dot');
    const text = document.getElementById('ollama-status-text');
    const detail = document.getElementById('ollama-detail');

    dot.className = 'ollama-dot';
    text.textContent = 'ì—°ê²° í™•ì¸ ì¤‘...';
    detail.textContent = '';

    try {
      // /api/tags ë¡œ ëª¨ë¸ ëª©ë¡ ì¡°íšŒ (Ollama í—¬ìŠ¤ì²´í¬)
      const res = await fetch(`${APP.ollamaUrl}/api/tags`, { signal: AbortSignal.timeout(4000) });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      const models = (data.models || []).map(m => m.name);
      const targetModel = APP.ollamaModel;
      const hasModel = models.some(m => m.startsWith(targetModel.split(':')[0]));

      dot.className = 'ollama-dot ok';
      ollamaOk = true;

      if (hasModel) {
        text.textContent = `ì—°ê²°ë¨ â€” ${targetModel} ì¤€ë¹„ ì™„ë£Œ`;
        text.style.color = 'var(--success)';
        detail.textContent = `ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸: ${models.join(', ')}`;
      } else {
        text.textContent = `ì—°ê²°ë¨ â€” ëª¨ë¸ ì—†ìŒ`;
        text.style.color = 'var(--warn)';
        detail.innerHTML = `<span style="color:var(--warn)">âš ï¸ <code>${targetModel}</code> ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤. í„°ë¯¸ë„ì—ì„œ <code>ollama pull ${targetModel}</code> ì‹¤í–‰ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.</span>`;
        ollamaOk = false;
      }
    } catch (e) {
      dot.className = 'ollama-dot err';
      ollamaOk = false;
      text.textContent = 'Ollama ë¯¸ì‹¤í–‰';
      text.style.color = 'var(--danger)';
      detail.innerHTML = `<span style="color:var(--danger)">í„°ë¯¸ë„ì—ì„œ <code>ollama serve</code>ë¥¼ ì‹¤í–‰í•œ ë’¤ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.</span>`;
    }
  }

  // â”€â”€ ë‚œì´ë„ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function selectDiff(d) {
    selectedDiff = d;
    ['easy','medium','hard'].forEach(x =>
      document.getElementById('diff-' + x).classList.toggle('active', x === d));
    updatePanelPreview();
  }

  // â”€â”€ ëª¨ë“œ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function selectMode(m) {
    selectedMode = m;
    ['public','corp','mixed'].forEach(x =>
      document.getElementById('mode-' + x).classList.remove('active'));
    const map = { public_servant:'public', public_corp:'corp', mixed:'mixed' };
    document.getElementById('mode-' + map[m])?.classList.add('active');
  }

  // â”€â”€ íŒ¨ë„ ë¯¸ë¦¬ë³´ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updatePanelPreview() {
    const panels = APP.difficultyPanels[selectedDiff];
    const sample = panels[0]; // ì²« ë²ˆì§¸ ì¡°í•© í‘œì‹œ
    const container = document.getElementById('panel-preview');
    container.innerHTML = sample.map(id => {
      const iw = APP.interviewers[id];
      return `<span class="panel-chip">${iw?.emoji || 'ğŸ‘¤'} ${iw?.name || id}</span>`;
    }).join('');
  }

  // â”€â”€ ë©´ì ‘ ì‹œì‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startInterview() {
    if (!ollamaOk) {
      showToast('Ollamaê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'warn');
      checkOllama();
      return;
    }
    const config = {
      difficulty:      selectedDiff,
      mode:            selectedMode,
      timeLimitEnabled: document.getElementById('opt-timelimit').checked,
      timeLimitSec:    APP.timeLimitBySetting[selectedDiff],
      subtitleOnly:    document.getElementById('opt-subtitle').checked,
      typingMode:      document.getElementById('opt-typing').checked,
    };
    APP.setSessionConfig(config);
    goTo('device-check.html');
  }
</script>
</body>
</html>
